#!/bin/sh
playlist="$HOME/.music-playlist"
config="$HOME/.musicrc"

if [ -n "$1" ]; then
  folder=$(realpath -q "$1")
  opts=$(sed 's/^/-/' "$config" | tr '\n' ' ')

  find "$folder" -type f $opts > "$playlist" 2>/dev/null

  printf "Found %'d song(s) in '%s'" $(wc -l < "$playlist") "$folder"
  echo -e "\n"
fi

if [ ! -s $playlist ]; then
  echo "The playlist was not generated or is empty."
  echo
  echo "To (re)generate the playlist, run:"
  echo "  music Directory/"
  exit
fi

mpv --shuffle --loop=inf --no-video --playlist "$playlist"
